<?xml version="1.0" encoding="iso-8859-1"?>
<modules>
    <module name='simple-blog'>
        <specification>
            <description>
                <name>Simple Blog</name>
                <version>1.0</version>
                <short>Blog</short>
                <long><![CDATA[Simple Blog System]]></long>
            </description>

            <components>
<!-- 
                <element name='sbs-post' render='zobject' src='sbs' definition="zobjectdef/@name" />
                <element name='sbs-comments' render='zobject' src='zo-comment' definition="zactiondef/@name" />
                <element name='sbs-feed' render='zobject_action' src='zo-class-zaction' definition="zactiondef/@name" />
                <element name='sbs-feeditem' render='zobject_action' src='zo-class-zaction' definition="zactiondef/@name" />
                <element name='zobject' render='zobject' src='zo' definition="zobjectdef/@name" /> 
-->

                <element name='sbs-feedload' render='sbs_feedload' src='sbs' />
            </components>

            <program>
                <extension name="simple-blog" type="page" src="php:sbs_page" />
            </program>
        </specification>

        <file id='sbs' type='php' src='blog.php' mode='startup' />
        <file id='sbs' type='php' src='blog_feedload.php' mode='startup' />

        <zobjectdef name="sbs-post-list" key-field="id" index="postid" allow-display="[!]" source='sbst-post'>
            <style>
                <caption>Options</caption>
                <class>sbs-post</class>
                <options addonlist="1" />
            </style>
            <action>php:zwpadmin_redirect_url</action>
            <render name="wp-list" type="list" src="templates/zobjects-wp-admin-action-list.xml" />
            <render name="wp-edit" type="edit" src="templates/zobjects-wp-admin-action-edit.xml" />
            <!-- <render name="wp-edit" type="create" src="templates/zobjects-wp-admin-action-create.xml" /> -->
            <xmlfile src="php:options_xml_file" list="/*/option/@userid" base="/*/option[@userid='@id']/" sort='userid' />
            <fielddefs>
                <fielddef id="postid" />
                <fielddef id="status" />
                <fielddef id="date" />
                <fielddef id="author" />
                <fielddef id="title" />
                <fielddef id="slug" />
                <fielddef id="tags" />
            </fielddefs>
        </zobjectdef>

        <zobjectdef name="sbs-post" key-field="id" index="postid" allow-display="[!]" source='sbst-post'>
            <style>
                <caption>Options</caption>
                <class>sbs-post</class>
                <options addonlist="1" />
            </style>
            <action>php:zwpadmin_redirect_url</action>
            <render name="wp-edit" type="edit" src="templates/zobjects-wp-admin-action-edit.xml" />
            <!-- <render name="wp-edit" type="create" src="templates/zobjects-wp-admin-action-create.xml" /> -->
            <xmlfile src="php:options_xml_file" list="/*/option/@userid" base="/*/option[@userid='@id']/" sort='userid' />
            <fielddefs>
                <fielddef id="postid" />
                <fielddef id="status" />
                <fielddef id="date" />
                <fielddef id="author" />
                <fielddef id="title" />
                <fielddef id="tags" />
                <fielddef id="body" />
            </fielddefs>
        </zobjectdef>

        <zobjectdef name="sbs-comment" key-field="id" index="postid" allow-display="[!]" source='sbst-post'>
            <style>
                <caption>Options</caption>
                <class>sbs-post</class>
                <options addonlist="1" />
            </style>
            <action>php:zwpadmin_redirect_url</action>
            <render name="wp-edit" type="edit" src="templates/zobjects-wp-admin-action-edit.xml" />
            <!-- <render name="wp-edit" type="create" src="templates/zobjects-wp-admin-action-create.xml" /> -->
            <xmlfile src="php:options_xml_file" list="/*/option/@userid" base="/*/option[@userid='@id']/" sort='userid' />
            <fielddefs>
                <fielddef id="commentid" />
                <fielddef id="postid" />
                <fielddef id="date" />
                <fielddef id="author" />
                <fielddef id="title" />
                <fielddef id="tags" />
                <fielddef id="comment-text" />
                <fielddef id="body" />
            </fielddefs>
        </zobjectdef>

        <ztabledef name='sbst-post' index='postid'>
            <fielddefs>
                <fielddef id="postid" datatype="sbs-id" access="@" required="1" allow-edit="[-]" allow-create="[-]" />
                <fielddef id="status" datatype="sbs-post-status" access="@" />
                <fielddef id="date" datatype="datetime" access='@' />
                <fielddef id="author" datatype="string" access='@' />
                <fielddef id="title" datatype="string" access='@' required="1" />
                <fielddef id="slug" datatype="string" getter='php:sbs_slug,@title' />
                <fielddef id="tags" datatype="string" />
                <fielddef id="body" datatype="sbs-post-body" />
            </fielddefs>
        </ztabledef>

        <ztabledef name='sbst-comment' index='commentid'>
            <fielddefs>
                <fielddef id="commentid" datatype="string" access="@" required="1" allow-edit="[-]" allow-create="[-]" />
                <fielddef id="postid" datatype="sbs-id" access='@' />
                <fielddef id="refid" datatype="sbs-id" access='@' />
                <fielddef id="date" datatype="string" access='@' />
                <fielddef id="author" datatype="string" access='@' />
                <fielddef id="body" datatype="sbs-post-comment" />
            </fielddefs>
        </ztabledef>

        <typedef name="sbs-id" db-type="uuid"  />
        <typedef name="sbs-post-status" html-type="select" db-type="varchar" maxlength="30" source="draft|review|private|published|deleted|recycle" />
        <typedef name="sbs-post-body" html-type="select" db-type="memo" getter="php:sbs_blog_post_get" setter="php:sbs_blog_post_set" />
        <typedef name="sbs-post-comment" html-type="select" db-type="memo"  getter="php:sbs_blog_comment_get" setter="php:sbs_blog_comment_set"/>
    </module>
</modules>